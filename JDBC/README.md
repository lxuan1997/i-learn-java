# JDBC

`JDBC`是`Java DataBase Connectivity`的缩写，它是`Java`程序访问数据库的标准接口。

## JDBC 接口

使用`Java`程序访问数据库时，`Java`代码并不是直接通过`TCP`连接去访问数据库，而是通过`JDBC接口`来访问

## JDBC 驱动

`JDBC接口`则通过`JDBC驱动`来实现真正对数据库的访问。
从代码来看，`Java`标准库自带的`JDBC接口`其实就是定义了一组接口，而某个具体的`JDBC驱动`其实就是实现了这些接口的类：

```
┌ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┐

│  ┌───────────────┐  │
   │   Java App    │
│  └───────────────┘  │
           │
│          ▼          │
   ┌───────────────┐
│  │JDBC Interface │◀─┼─── JDK
   └───────────────┘
│          │          │
           ▼
│  ┌───────────────┐  │
   │ MySQL Driver  │◀───── Oracle
│  └───────────────┘  │
           │
└ ─ ─ ─ ─ ─│─ ─ ─ ─ ─ ┘
           ▼
   ┌───────────────┐
   │     MySQL     │
   └───────────────┘
```

实际上，一个`MySQL`的`JDBC驱动`就是一个`jar`包，它本身也是纯`Java`编写的；

我们自己编写的代码只需要引用`Java`标准库提供的`java.sql`包下面的相关接口，由此再间接地通过`MySQL`驱动的`jar`包通过网络访问`MySQL`服务器，所有复杂的网络通讯都被封装到`JDBC驱动`；

因此，`Java`程序本身只需要引入一个`MySQL`驱动的 jar 包就可以正常访问`MySQL`服务器：

```
┌ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┐
   ┌───────────────┐
│  │   App.class   │  │
   └───────────────┘
│          │          │
           ▼
│  ┌───────────────┐  │
   │  java.sql.*   │
│  └───────────────┘  │
           │
│          ▼          │
   ┌───────────────┐     TCP    ┌───────────────┐
│  │ mysql-xxx.jar │──┼────────▶│     MySQL     │
   └───────────────┘            └───────────────┘
└ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┘
          JVM
```

## JDBC 连接

`Connection`代表一个`JDBC`连接，它相当于`Java`程序到数据库的连接（通常是`TCP`连接）

打开一个`Connection`时，需要准备`URL`、`用户名`和`口令`，才能成功连接到数据库

### URL

`URL`是由数据库厂商指定的格式，例如，`MySQL`的`URL`是：

```xml
jdbc:mysql://<hostname>:<port>/<db>?key1=value1&key2=value2
```

## JDBC 事务

数据库事务`Transaction`是由若干个`SQL`语句构成的一个操作序列，有点类似于`Java`的`synchronized`同步

数据库系统保证在一个事务中的所有`SQL`**要么全部执行成功，要么全部不执行**，即数据库事务具有`ACID`特性：

- `Atomicity`：原子性
- `Consistency`：一致性
- `Isolation`：隔离性
- `Durability`：持久性


要在`JDBC`中执行事务，本质上就是如何把多条`SQL`包裹在一个数据库事务中执行。


## JDBC Batch

## JDBC 连接池
创建线程是一个昂贵的操作，如果有大量的小任务需要执行，并且频繁地创建和销毁线程，实际上会消耗大量的系统资源，往往创建和消耗线程所耗费的时间比执行任务的时间还长，所以，为了提高效率，可以用线程池。

类似的，在执行`JDBC`的增删改查的操作时，如果每一次操作都来一次打开连接，操作，关闭连接，那么创建和销毁`JDBC`连接的开销就太大了。

为了避免频繁地创建和销毁`JDBC`连接，我们可以通过连接池（`Connection Pool`）复用已经创建好的连接。